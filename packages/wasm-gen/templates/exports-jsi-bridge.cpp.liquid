//
// THIS FILE WAS GENERATED BY `react-native-wasm`
//
// DO NO EDIT THIS FILE, AS ANY CHANGES WILL BE LOST
//
#include "jsi-exports-bridge.h"
#include "macros.h"
#include "wasm-rt.h"

namespace facebook::react {

{%- capture ctx_class %}{{ moduleSafeName | capitalize }}ModuleContext{% endcapture %}
{%- capture turbo_module_name %}ReactNative{{ moduleSafeName | capitalize }}{% endcapture %}

std::shared_ptr<{{ ctx_class }}> tryGetContext(jsi::Runtime& rt, const jsi::Object& obj) {
  if (!obj.hasNativeState(rt)) {
    return nullptr;
  }

  return std::dynamic_pointer_cast<{{ ctx_class }}>(obj.getNativeState(rt));
}

jsi::Object create{{ moduleSafeName | capitalize }}Exports(jsi::Runtime &rt, jsi::Object importObject) {
  jsi::Object mod { rt };

  if (!wasm_rt_is_initialized()) {
    wasm_rt_init();
  }

  auto inst = std::make_shared<{{ ctx_class }}>(rt, std::move(importObject));
  wasm2c_rapier__wasm3d__bg_instantiate(&inst->ctx, &inst->wbg);

  mod.setNativeState(rt, inst);

  // Fill Exports
  jsi::Object exports {rt};

  {% for export in exports %}
    /* export: '{{ export.name }}' */
    exports.setProperty(rt, "{{ export.name }}", HOSTFN("{{ export.name }}", {{ export.params.size }}) {
      auto nativeState = tryGetContext(rt, thisValue.getObject(rt));
      {%- capture args -%}
        {%- for arg_name in export.params -%}
          , args[{{ forloop.index0 }}].asNumber()
        {%- endfor %}
      {%- endcapture %}
      {% if export.return_type -%}
      auto res =
      {%- endif -%}

    {{ export.generated_c_func_name }}(&nativeState->ctx{{ args }});

      {% if export.return_type -%}
        return jsi::Value { (double)res };
      {%- else -%}
        return jsi::Value::undefined();
      {%- endif %}
    }));
  {% endfor %}

  exports.setNativeState(rt, inst);
  mod.setProperty(rt, "exports", std::move(exports));

  // end full exports
  return mod;
}

}
